# Railway deployment configuration for monorepo
# Uses Nixpacks builder to install backend dependencies and start FastAPI

[build]
builder = "NIXPACKS"
# Install Python tooling, create an isolated virtual environment, and install backend deps inside it.
# `PIP_BREAK_SYSTEM_PACKAGES` is set defensively in case Railpack falls back to system pip during detection.
buildCommand = "apt-get update && apt-get install -y python3 python3-venv python3-pip && PIP_BREAK_SYSTEM_PACKAGES=1 python3 -m venv /app/.venv && /app/.venv/bin/python -m pip install --no-cache-dir -r backend/requirements.txt"

[deploy]
# Health endpoint exposed by backend
healthcheckPath = "/health"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3
# Use the helper script so Railpack/Nixpacks can autodetect the start command
startCommand = "./start.sh"